# MySQL Optimizer

## MySQL 계층

1.	클라이언트 계층: 사용자가 SQL 쿼리를 입력하고 결과를 받는 계층입니다.
2.	SQL 계층:
	-	파서(Parser): 쿼리를 구문 분석하여 SQL 명령의 구조를 이해합니다.
	-	전처리기(Preprocessor): 구문 분석된 쿼리를 최적화하기 위한 사전 작업을 수행합니다.
	-	**옵티마이저(Optimizer)**: 쿼리를 가장 효율적으로 실행하기 위한 최적의 실행 계획을 수립합니다.
	-	실행 엔진(Execution Engine): 옵티마이저가 생성한 실행 계획에 따라 실제로 쿼리를 실행합니다.
3.	스토리지 엔진 계층: 실제 데이터가 저장되고 관리되는 계층으로, InnoDB, MyISAM 등 다양한 스토리지 엔진이 있습니다.

## 옵티마이저의 역할과 중요성

1.	실행 계획 생성
	-	테이블 액세스 방법 결정: 테이블을 어떤 순서로 읽을지, 어떤 인덱스를 사용할지 결정합니다.
	-	조인 순서 결정: 여러 테이블을 조인할 때 어떤 순서로 조인할지 결정합니다.
	-	인덱스 사용 여부 결정: 인덱스를 사용할지, 전체 테이블 스캔을 할지 판단합니다.
2.	쿼리 변환 및 재작성
	-	쿼리를 더 효율적으로 실행할 수 있도록 내부적으로 쿼리를 변환하거나 재작성합니다.
	-	예를 들어, 서브쿼리를 조인으로 변경하거나 불필요한 연산을 제거합니다.
3.	비용 기반 분석
	-	각 실행 계획에 대해 **비용(cost)**을 계산하여 가장 낮은 비용을 가진 계획을 선택합니다.
	-	비용은 디스크 I/O, CPU 사용량, 메모리 사용량 등을 고려하여 산출됩니다.


## 옵티마이저의 작동 과정

1.	쿼리 수신: 사용자가 입력한 SQL 쿼리가 MySQL 서버로 전달됩니다.
2.	구문 분석: 파서(Parser)가 쿼리의 문법을 확인하고 구조를 파악합니다.
3.	전처리: 전처리기가 테이블 및 컬럼의 존재 여부, 사용자 권한 등을 확인합니다.
4.	최적화 단계:
	-	**옵티마이저**가 가능한 **실행 계획들을 생성**합니다.
	-	각 실행 계획의 비용을 계산하여 **최소 비용의 실행 계획을 선택**합니다.
5.	실행 및 결과 반환: 실행 엔진이 선택된 실행 계획에 따라 쿼리를 실행하고 결과를 반환합니다.


## 옵티마이저가 고려하는 요소들

1.	인덱스
	-	테이블에 정의된 인덱스의 존재 여부와 인덱스의 종류.
	-	인덱스의 선택도: 인덱스가 얼마나 효율적으로 검색 범위를 좁힐 수 있는지.
2.	통계 정보
	-	테이블과 인덱스의 통계 정보: 행의 수, 고유 값의 수, 데이터 분포 등.
	-	최신의 통계 정보는 정확한 실행 계획 수립에 필수적입니다.
3.	테이블 크기
	-	각 테이블의 데이터 양과 행의 수.
4.	조건절
	-	WHERE 절의 조건과 JOIN 조건.
	-	조건에 사용된 연산자와 상수 값.
5.	시스템 자원
	-	서버의 메모리 크기, CPU 성능, 디스크 I/O 속도 등.

## 옵티마이저가 선택할 수 있는 액세스 방법

1.	전체 테이블 스캔(Full Table Scan)
	-	인덱스를 사용하지 않고 테이블의 모든 행을 순차적으로 읽는 방법입니다.
2.	인덱스 스캔(Index Scan)
	-	인덱스를 활용하여 필요한 데이터만 읽는 방법입니다.
		-	인덱스 레인지 스캔(Index Range Scan): 인덱스의 특정 범위를 검색.
		-	인덱스 유니크 스캔(Index Unique Scan): 인덱스의 고유한 값을 검색.
3.	인덱스 머지(Index Merge)
	-	여러 개의 인덱스를 결합하여 검색하는 방법입니다.
4.	조인 방식
	-	Nested Loop Join: 한 테이블의 각 행에 대해 다른 테이블을 검색.
	-	Hash Join: 해시 테이블을 생성하여 조인.
	-	Sort-Merge Join: 두 테이블을 정렬한 후 병합하여 조인.


## MySQL 내부에서의 옵티마이저와 다른 엔진의 관계

-	스토리지 엔진(Storage Engine):
	-	MySQL은 **InnoDB, MyISAM** 등 다양한 스토리지 엔진을 지원하며, 실제 데이터의 저장과 검색을 담당합니다.
	-	각 스토리지 엔진은 고유한 특성과 기능을 가지며, 옵티마이저는 이러한 특성을 고려하여 실행 계획을 수립합니다.
-	실행 엔진(Execution Engine):
	-	옵티마이저가 생성한 실행 계획을 따라 **쿼리를 실제로 실행하는 역할**을 합니다.
	-	실행 엔진은 스토리지 엔진과 상호 작용하여 데이터를 읽거나 씁니다.
-	옵티마이저의 독립성:
	-	옵티마이저는 **스토리지 엔진과는 독립적으로 동작**하지만, 스토리지 엔진의 특성(예: 인덱스 구조, 락 메커니즘)을 고려하여 최적의 실행 계획을 수립합니다.


## 옵티마이저와 개발자의 역할

-	개발자는 옵티마이저가 최적의 실행 계획을 수립할 수 있도록 다음과 같은 노력이 필요

1.	인덱스 최적화
	-	쿼리에 맞는 적절한 인덱스를 생성합니다.
2.	쿼리 최적화
	-	비효율적인 쿼리 작성을 피하고, 간결하고 최적화된 쿼리를 작성합니다.
3.	통계 정보 관리
	-	ANALYZE TABLE 명령을 통해 통계 정보를 최신 상태로 유지합니다.
4.	데이터베이스 설정 조정
	-	메모리 할당, 버퍼 크기 등 데이터베이스 설정을 최적화합니다.